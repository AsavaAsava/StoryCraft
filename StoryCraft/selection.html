<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="selection.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Fredoka One&family=Open+Sans&family=Roboto:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="loader.css">
    <title>Make Selection</title>
</head>

<body>
    <nav class="navbar">
        <ul class="menu-logo">
            <li><a class="logo" href="./landing.html">StoryCraft</a></li>
        </ul>
        <ul class="menu-items">
            <li><a href="#">Build a story</a></li>
            <li><a href="loginpage.html"><span class="material-symbols-outlined">account_circle</span></a></li>
            <li><a>
                    <select name="languages" id="lang">
                        <option value="english">English</option>
                        <option value="kiswahili">Swahili</option>
                        <option value="french">French</option>
                    </select>
                </a>
            </li>
        </ul>
    </nav>
    <div class="loader-container" id="loaderContainer">
        <div class="book">
            <img src="images/reading.gif" alt="Reading">
        </div>
        <h1>Writing the story</h1>
    </div>

    <div class="title-container">
        <h2 class="title">Build Your Story</h2>
        <hr>
    </div>
    <div class="container">
        <button class="btn-nav prev" onclick="plusSlides(-1)">
            <span class="material-symbols-outlined md-36">arrow_left_alt</span>
        </button>

        <div class="choice-section">
            <div class="first-q question fade">
                <div>
                    <label for="name">What is your name?</label><br>
                    <input type="text" name="name" id="name">
                </div>
                <div>
                    <label for="age">How old are you?</label><br>
                    <input type="number" name="age" id="age" min="1" max="20">
                </div>
            </div>
            <div class="question fade">
                <p>What language would you like your story to be in?</p>
                <div class="second-q">
                    <div class="option" tabindex="1" onclick="getLanguage('English')">
                        <img src="images/flags/united-kingdom.png" alt="English">
                        <p>English</p>
                    </div>
                    <div class="option" tabindex="2" onclick="getLanguage('Swahili')">
                        <img src="images/flags/eaflag.png" alt="Swahili">
                        <p>Swahili</p>
                    </div>
                    <div class="option" tabindex="3" onclick="getLanguage('French')">
                        <img src="images/flags/france (1).png" alt="French">
                        <p>French</p>
                    </div>
                    <div class="option" tabindex="4" onclick="getLanguage('Amharic')">
                        <img src="images/flags/ethiopia.png" alt="Amharic">
                        <p>Amharic</p>
                    </div>
                    <div class="option" tabindex="5" onclick="getLanguage('Hindi')">
                        <img src="images/flags/india.png" alt="Hindi">
                        <p>Hindi</p>
                    </div>
                </div>
            </div>
            <div class="question fade">
                <p>What is your favourite animal?</p>
                <div class="third-q">
                    <div class="option" tabindex="1" onclick="getAnimal('lion')">
                        <img src="images/animals/lion.png" alt="Lion">
                        <p>Lion</p>
                    </div>
                    <div class="option" tabindex="2" onclick="getAnimal('elephant')">
                        <img src="images/animals/elephant.png" alt="Elephant">
                        <p>Elephant</p>
                    </div>
                    <div class="option" tabindex="3" onclick="getAnimal('penguin')">
                        <img src="images/animals/penguin.png" alt="Penguin">
                        <p>Penguin</p>
                    </div>
                    <div class="option" tabindex="4" onclick="getAnimal('dolphin')">
                        <img src="images/animals/dolphin.png" alt="Dolphin">
                        <p>Dolphin</p>
                    </div>
                    <div class="option" tabindex="5" onclick="getAnimal('giraffe')">
                        <img src="images/animals/giraffe.png" alt="Giraffe">
                        <p>Giraffe</p>
                    </div>
                </div>
            </div>
            <div class="question fade">
                <p>What is the most exciting place you have been to?</p>
                <div class="third-q">
                    <div class="option" tabindex="1" onclick="getPlace('beach')">
                        <img src="images/places/vacations.png" alt="Beach">
                        <p>The Beach</p>
                    </div>
                    <div class="option" tabindex="2" onclick="getPlace('zoo')">
                        <img src="images/places/zoo.png" alt="Zoo">
                        <p>The Zoo</p>
                    </div>
                    <div class="option" tabindex="3" onclick="getPlace('amusement-park')">
                        <img src="images/places/amusement-park.png" alt="Amusement-park">
                        <p>Amusement-park</p>
                    </div>
                    <div class="option" tabindex="4" onclick="getPlace('toy-shop')">
                        <img src="images/places/toy-shop.png" alt="Toy-shop">
                        <p>Toy Shop</p>
                    </div>
                    <div class="option" tabindex="5" onclick="getPlace('arcade')">
                        <img src="images/places/game-console.png" alt="Arcade">
                        <p>Gaming Arcade</p>
                    </div>
                </div>
            </div>
            <div class="question fade">
                <p>Do you have a special talent or hobby?</p>
                <div class="third-q">
                    <div class="option" tabindex="1" onclick="getTalent('painting')">
                        <img src="images/talents/painting.png" alt="Painting">
                        <p>Painting</p>
                    </div>
                    <div class="option" tabindex="2" onclick="getTalent('dancing')">
                        <img src="images/talents/dance.png" alt="Dancing">
                        <p>Dancing</p>
                    </div>
                    <div class="option" tabindex="3" onclick="getTalent('football')">
                        <img src="images/talents/soccer-game.png" alt="Football">
                        <p>Football</p>
                    </div>
                    <div class="option" tabindex="4" onclick="getTalent('singing')">
                        <img src="images/talents/singing.png" alt="Singing">
                        <p>Singing</p>
                    </div>
                    <div class="option" tabindex="5" onclick="getTalent('building-blocks')">
                        <img src="images/talents/construction.png" alt="Building-blocks">
                        <p>Building-blocks</p>
                    </div>
                </div>
            </div>
            <div class="question fade">
                <p>Is there a superhero you admire?</p>
                <div class="third-q">
                    <div class="option" tabindex="1" onclick="getHero('spiderman')">
                        <img src="images/heroes/spiderman.png" alt="Spiderman">
                        <p>Spiderman</p>
                    </div>
                    <div class="option" tabindex="2" onclick="getHero('wonderwoman')">
                        <img src="images/heroes/wonderwoman.png" alt="Wonderwoman">
                        <p>Wonderwoman</p>
                    </div>
                    <div class="option" tabindex="3" onclick="getHero('batman')">
                        <img src="images/heroes/batman.png" alt="Batman">
                        <p>Batman</p>
                    </div>
                    <div class="option" tabindex="4" onclick="getHero('elsa')">
                        <img src="images/heroes/elsa.png" alt="Elsa from Frozen">
                        <p>Elsa from Frozen</p>
                    </div>
                    <div class="option" tabindex="5" onclick="getHero('ironman')">
                        <img src="images/heroes/ironman.png" alt="Ironman">
                        <p>Ironman</p>
                    </div>
                </div>
            </div>

            <div class="question fade">
                <p>How are you feeling today?</p>
                <div class="third-q">
                    <div class="option" tabindex="1" onclick="getMood('happy')">
                        <img src="images/emotions/happy.png" alt="Happy">
                        <p>Happy</p>
                    </div>
                    <div class="option" tabindex="2" onclick="getMood('sad')">
                        <img src="images/emotions/sad.png" alt="Sad">
                        <p>Sad</p>
                    </div>
                    <div class="option" tabindex="3" onclick="getMood('excited')">
                        <img src="images/emotions/smiley.png" alt="Excited">
                        <p>Excited</p>
                    </div>
                    <div class="option" tabindex="4" onclick="getMood('bored')">
                        <img src="images/emotions/bored (1).png" alt="Bored">
                        <p>Bored</p>
                    </div>
                    <div class="option" tabindex="5" onclick="getMood('curious')">
                        <img src="images/emotions/curious.png" alt="Curious">
                        <p>Curious</p>
                    </div>
                </div>
            </div>
        </div>
        <button class="btn-nav next" onclick="plusSlides(1)">
            <span class="material-symbols-outlined md-36">arrow_right_alt</span>
        </button>
    </div>
    <div class="bottom-nav">
        <span class="line" onclick="currentSlide(1)"></span>
        <span class="line" onclick="currentSlide(2)"></span>
        <span class="line" onclick="currentSlide(3)"></span>
        <span class="line" onclick="currentSlide(4)"></span>
        <span class="line" onclick="currentSlide(5)"></span>
        <span class="line" onclick="currentSlide(6)"></span>
        <span class="line" onclick="currentSlide(7)"></span>
    </div>
    <div class="btn-generate">
        <button onclick="generateStory()">Generate</button>
    </div>
    <script>
        const BASE_URL = 'http://127.0.0.1:5000/';

        let slideIndex = 1;
        let language = "English";
        let animal = "lion";
        let place = "beach";
        let talent = "singing";
        let hero = "spiderman";
        let mood = "happy";

        showSlides(slideIndex);

        function plusSlides(n) {
            showSlides(slideIndex += n);
        }

        function currentSlide(n) {
            showSlides(slideIndex = n);
        }



        function showSlides(n) {
            let i;
            let slides = document.getElementsByClassName("question");
            let lines = document.getElementsByClassName("line");
            if (n > slides.length) { slideIndex = 1 }
            if (n < 1) { slideIndex = slides.length }
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            for (i = 0; i < lines.length; i++) {
                lines[i].className = lines[i].className.replace(" active", "");
            }
            slides[slideIndex - 1].style.display = "block";
            lines[slideIndex - 1].className += " active";
        }

        function getLanguage(lang) {
            language = lang;
        }

        function getAnimal(name) {
            animal = name;
        }

        function getPlace(name) {
            place = name;
        }

        function getTalent(name) {
            talent = name;
        }

        function getHero(name) {
            hero = name;
        }

        function getMood(name) {
            mood = name;
        }

        async function generateStory() {
            document.getElementById("loaderContainer").style.visibility = "visible";
            var uid = localStorage.getItem("uid");
            const jsonBody = {
                "uid": uid,
                "name": document.getElementById("name").value,
                "age": document.getElementById("age").value,
                "choices": [
                    {
                        "language": language,
                        "favorite_animal": animal,
                        "exciting_place": place,
                        "special_interest": talent,
                        "superhero": hero,
                        "mood": mood
                    }
                ]
            }

            console.log(JSON.stringify(jsonBody));

            const response = await fetch(BASE_URL + 'generate_story', {
                method: 'POST',
                body: JSON.stringify(jsonBody),
                headers: {
                    'Content-Type': 'application/json'
                }
            });

            const responseJson = await response.json();
            localStorage.setItem("story", JSON.stringify(responseJson));
            let storyw = localStorage.getItem("story");
            console.log(responseJson)
            console.log(JSON.parse(storyw));
            window.location.href = './storybook.html';
        }
    </script>
</body>

</html>