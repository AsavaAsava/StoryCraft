<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-auth.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Fredoka One&family=Open+Sans&family=Roboto:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="loginpage.css">
    <title>Login</title>
</head>

<body>
    <div class="container">
        <div class="left">
            <img src="images/reading.gif" alt="Reading Cat">
            <h2>StoryCraft</h2>
            <p>Building Stories, shaping futures</p>
        </div>
        <div class="right">
            <div id="register-container" class="register-container hidden">
                <h2>Create an account</h2>
                <hr>
                <form action="post" id="signUpForm">
                    <div class="form-group">
                        <input id="regEmail" type="email" required><span class="highlight"></span><span
                            class="bottom-line"></span>
                        <label for="regEmail">Email</label>
                    </div>
                    <div class="form-group">
                        <input id="regPassword" type="password" required><span class="highlight"></span><span
                            class="bottom-line"></span>
                        <label for="regPassword">Password</label>
                    </div>
                    <div class="form-group">
                        <input id="cfmpwd" type="password" required><span class="highlight"></span><span
                            class="bottom-line"></span>
                        <label for="cfmpwd">Confirm password</label>
                    </div>
                    <button type="submit"><span>Register</span></button>
                </form>

                <p>Already have an account? <span onclick="gotoLoginPage()">Login</span></p>
            </div>
            <div id="login-container" class="login-container">
                <h2>Welcome back</h2>
                <hr>
                <form action="post" id="loginForm">
                    <div class="form-group">
                        <input id="loginEmail" type="email" required><span class="highlight"></span><span
                            class="bottom-line"></span>
                        <label for="loginEmail">Email</label>
                    </div>
                    <div class="form-group">
                        <input id="loginPassword" type="password" required><span class="highlight"></span><span
                            class="bottom-line"></span>
                        <label for="loginPassword">Password</label>
                    </div>
                    <p>
                        <a href="forgotpwd.html">Forgot password?</a>
                    </p>
                    <button type="submit"><span>Login</span></button>
                </form>
                <p>OR</p>
                <button id="googleSignIn"><img src="images/google.png" alt="Google Logo"><span>Login with
                        Google</span></button>

                <p>Don't have an account? <span onclick="gotoRegisterPage()">Register</span>
            </div>
        </div>
    </div>

    <script>
        function gotoLoginPage() {
            var loginPage = document.getElementById("login-container");
            var registerPage = document.getElementById("register-container");
            registerPage.classList.add("fadeOff");
            registerPage.classList.add("hidden");
            setTimeout(function () {
                loginPage.classList.add("fadeIn");
                loginPage.classList.remove("hidden");
            }, 700);
        }

        function gotoRegisterPage() {
            var loginPage = document.getElementById("login-container");
            var registerPage = document.getElementById("register-container");
            loginPage.classList.add("fadeOff");
            loginPage.classList.add("hidden");
            setTimeout(function () {
                registerPage.classList.add("fadeIn");
                registerPage.classList.remove("hidden");
            }, 700);
        }

        $(window, document, undefined).ready(function () {
            $('input').blur(function () {
                var $this = $(this);
                if ($this.val())
                    $this.addClass('done');
                else
                    $this.removeClass('done');
            });
        });

        //Firebase setup
        var config = {
            apiKey: "AIzaSyDiPkM01PcS84zFdsbCrXkMbPWDbX8bHqM",
            authDomain: "a2sv-hackathon.firebaseapp.com",
            projectId: "a2sv-hackathon",
            storageBucket: "a2sv-hackathon.appspot.com",
            messagingSenderId: "335557285236",
            appId: "1:335557285236:web:95de9a7b59613041ef8821",
            measurementId: "G-TJ192BJEB9"
        };
        firebase.initializeApp(config);

        // Initialize Firebase Authentication
        var auth = firebase.auth();

        // Sign-Up Form Logic
        document.getElementById("signUpForm").addEventListener("submit", function (e) {
            e.preventDefault();
            var email = document.getElementById("regEmail").value;
            var password = document.getElementById("regPassword").value;
            var confirmPassword = document.getElementById("cfmpwd").value;

            // Check if passwords match
            if (password !== confirmPassword) {
                alert("Passwords do not match.");
                return;
            }

            // Create a new user with email and password
            auth.createUserWithEmailAndPassword(email, password)
                .then(function (userCredential) {
                    console.log(userCredential.uid);
                    localStorage.setItem("uid", userCredential.uid);
                    window.location.href ="landing.html"
                    // Successful sign-up, you can redirect to another page or perform further actions here.
                })
                .catch(function (error) {
                    // Handle sign-up errors here.
                    console.error(error.message);
                });
        });


        // Logic for login
        // Email and Password Sign-In
        document.getElementById("loginForm").addEventListener("submit", function (e) {
            e.preventDefault();
            var loginEmail = document.getElementById("loginEmail").value;
            var loginPassword = document.getElementById("loginPassword").value;
            auth.signInWithEmailAndPassword(loginEmail, loginPassword)
                .then(function (user) {
                    // Successful sign-in, you can redirect to another page or perform further actions here.
                    localStorage.setItem("uid", user.user.uid);
                    window.location.href ="landing.html"
                })
                .catch(function (error) {
                    // Handle sign-in errors here.
                    alert("Invalid Credentials");
                });
        });

        // Google Sign-In
        document.getElementById("googleSignIn").addEventListener("click", function () {
            var provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider)
                .then(function (result) {
                    // Successful Google sign-in, you can redirect or perform further actions here.
                    window.location.href= "landing.html";
                })
                .catch(function (error) {
                    // Handle Google sign-in errors here.
                    console.error(error.message);
                });
        });
    </script>
</body>

</html>